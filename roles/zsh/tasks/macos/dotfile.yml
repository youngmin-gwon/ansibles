---
- name: Ensure zsh is installed
  community.general.homebrew:
    name: zsh
    state: present
  become: false
  tags: macos

- name: Ensure zsh is in /etc/shells
  ansible.builtin.shell: |
    if ! grep -q "/opt/homebrew/bin/zsh" /etc/shells; then
      echo "/opt/homebrew/bin/zsh" | sudo tee -a /etc/shells
    fi
  become: true
  changed_when: false
  tags: macos

- name: Change default shell to zsh
  ansible.builtin.shell: chsh -s $(which zsh)
  become: true
  changed_when: false
  tags: macos
