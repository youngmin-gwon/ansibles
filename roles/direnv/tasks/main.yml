---
- name: Check if Direnv plugin is already added
  ansible.builtin.command: asdf plugin list
  register: plugin_list
  changed_when: false
  failed_when: false
  become: false
  tags: unix

- name: Add Direnv plugin if not already added
  ansible.builtin.command: asdf plugin add direnv
  when: "'direnv' not in plugin_list.stdout"
  register: plugin_added
  changed_when: plugin_added.rc == 0
  become: false
  tags: unix

- name: Configure latest version of direnv
  ansible.builtin.command: asdf direnv setup --shell bash --version {{ latest_version }}
  changed_when: false
  when: plugin_added.changed
  failed_when: false
  become: false
  tags: unix
