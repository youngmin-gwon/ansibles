---
- name: Check if plugin '{{ current_plugin.id }}' directory exists for '{{ current_android_studio_dir.path }}'
  ansible.builtin.stat:
    path: "{{ current_android_studio_dir.path }}/plugins/{{ current_plugin.dir_name }}"
  register: plugin_stat_result
  changed_when: false
  when: current_android_studio_dir.path is defined and ansible_os_family == "Darwin"
  tags: unix

- name: Install plugin '{{ current_plugin.id }}' via Android Studio CLI for '{{ current_android_studio_dir.path }}'
  # ğŸš¨ ìˆ˜ì •: ê³µë°±ì´ í¬í•¨ëœ ê²½ë¡œë¥¼ ìœ„í•´ ì‹¤í–‰ íŒŒì¼ ê²½ë¡œë¥¼ ì´ì¤‘ ë”°ì˜´í‘œë¡œ ê°ìŒˆ
  ansible.builtin.command: "{{ android_studio_app_bundle_path | quote }}/Contents/MacOS/studio installPlugins {{ current_plugin.id }}"
  when:
    - current_android_studio_dir.path is defined
    - ansible_os_family == "Darwin"
    - android_studio_app_bundle_path is defined
    - not plugin_stat_result.stat.exists # ğŸš¨ ë©±ë“±ì„± í•µì‹¬: í”ŒëŸ¬ê·¸ì¸ ë””ë ‰í„°ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œë§Œ ì‹¤í–‰
  changed_when: true # ì´ ëª…ë ¹ì´ ì‹¤í–‰ë˜ë©´ ë³€ê²½ì´ ë°œìƒí–ˆë‹¤ê³  ê°€ì •
  # stderrì— ì—ëŸ¬ ë©”ì‹œì§€(ì˜ˆ: already installed)ê°€ í¬í•¨ë  ê²½ìš°ì—ë„ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
  failed_when: "'already installed' not in studio_plugin_install_result.stderr and studio_plugin_install_result.rc != 0"
  register: studio_plugin_install_result
  tags: unix
